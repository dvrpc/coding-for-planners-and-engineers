
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>Spatial data - Coding for Planners & Engineers</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spatial-data" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Coding for Planners &amp; Engineers" class="md-header__button md-logo" aria-label="Coding for Planners & Engineers" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5a.5.5 0 0 0 .5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5a.5.5 0 0 0-.5-.5l-.16.03L15 5.1 9 3M8 5.45v11.7l-3 1.16V6.46l3-1.01m2 .02 4 1.4v11.66l-4-1.4V5.47m9 .23v11.84l-3 1.01V6.86l3-1.16m-11.54.6-1.89.67v2.15l1.89-.67V6.3m0 2.75-1.89.67v2.15l1.89-.67V9.05m0 2.75-1.89.67v2.15l1.89-.67V11.8m0 2.75-1.89.67v2.15l1.89-.67v-2.15z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Coding for Planners & Engineers
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Spatial data
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Coding for Planners &amp; Engineers" class="md-nav__button md-logo" aria-label="Coding for Planners & Engineers" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5a.5.5 0 0 0 .5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5a.5.5 0 0 0-.5-.5l-.16.03L15 5.1 9 3M8 5.45v11.7l-3 1.16V6.46l3-1.01m2 .02 4 1.4v11.66l-4-1.4V5.47m9 .23v11.84l-3 1.01V6.86l3-1.16m-11.54.6-1.89.67v2.15l1.89-.67V6.3m0 2.75-1.89.67v2.15l1.89-.67V9.05m0 2.75-1.89.67v2.15l1.89-.67V11.8m0 2.75-1.89.67v2.15l1.89-.67v-2.15z"/></svg>

    </a>
    Coding for Planners & Engineers
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Introduction
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Introduction" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Introduction
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/" class="md-nav__link">
        Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../README.md" class="md-nav__link">
        SQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../R/" class="md-nav__link">
        R
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Python Basics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python Basics" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Python Basics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/examples/basics/python_101/" class="md-nav__link">
        101
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/examples/basics/python_202/" class="md-nav__link">
        202
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Python Libraries
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python Libraries" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Python Libraries
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/examples/libraries/pandas/" class="md-nav__link">
        pandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/examples/libraries/geopandas/" class="md-nav__link">
        geopandas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/examples/libraries/plotly/" class="md-nav__link">
        plotly
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Databases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Databases" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Databases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/examples/databases/dotenv/" class="md-nav__link">
        .env file
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/examples/databases/psycopg2/" class="md-nav__link">
        psycopg2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Python/examples/databases/sqlalchemy/" class="md-nav__link">
        sqlalchemy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          R Basics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="R Basics" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          R Basics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../R/examples/exercise/" class="md-nav__link">
        Exercise
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../R/examples/exercise_answers/" class="md-nav__link">
        Exercise Answers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="spatial-data">Spatial data</h1>
<h2 id="loading-spatial-data">Loading spatial data</h2>
<p>GIS data can be loaded into postgres in a few ways:</p>
<ul>
<li>via the "PostGIS Shapefile Import/Export Manager" GUI, which can be found in the Start Menu</li>
<li>via the command-line tool <code>shp2pgsql</code></li>
<li>via Python code (using <code>geopandas</code> &amp; <code>geoalchemy2</code>)</li>
<li>via QGIS and the "Database Manager" extension</li>
</ul>
<h2 id="running-queries">Running queries</h2>
<p>Use your IDE to craft SQL queries, run them, and check the results. You can save your work by writing the SQL code to a text file that ends in <code>.sql</code> and manually rerunning it at a later date. You can also paste the SQL code into a Python script that automates the database connection and query execution, which is helpful when your analysis requires a series of steps in SQL (and/or Python processes interspersed with the querying).</p>
<h2 id="visualizing-spatial-data">Visualizing spatial data</h2>
<p>Desktop GIS software allows you to connect to your postgres database:</p>
<ul>
<li>QGIS allows reading and writing</li>
<li>ArcMap/Pro is read-only if you setup your db as mentioned in the <a href="../intro/">intro section</a>.  If an edit environment is needed using ArcMap/Pro, the GIS department is willing to help assist you with the geodatabase setup.</li>
</ul>
<h2 id="conventions">Conventions</h2>
<p>Spatial data is stored in a special column with a datatype of <code>geometry</code>, defined by <code>PostGIS</code>. Within this datatype the shapes allowed are <code>Point</code>, <code>Polygon</code>, and <code>LineString</code>, along with a <code>Multi</code>- variant for each. Typically this column is given the name "<code>geom</code>", although the ESRI-specific implementation of PostgreSQL uses the name "<code>shape</code>" for this column.</p>
<h1 id="accessing-dvrpc-gis-data">Accessing DVRPC GIS data</h1>
<h2 id="gis-database">GIS Database</h2>
<p>To access and query DVRPC gis data that's maintained by the GIS team you can use the following connection parameters.  The GIS db is a PostgreSQL/PostGIS db.  Features are commonly stored as SRID 26918 (UTM Zone 18, meters) and 4326 (WGS 1984, lat/long).</p>
<pre><code>host - gis-db
db - gis
port - 5432
user - dvrpc_viewer
password - viewer
</code></pre>
<h2 id="arcgis-rest-services">ArcGIS Rest Services</h2>
<p>All DVRPC GIS services can be found on our ArcGIS server https://arcgis.dvrpc.org/portal</p>
<p>Browsing through the directories you'll find map services and feature services.  You can query either of these endpoints to return information from each.</p>
<h3 id="sample-query">Sample query</h3>
<p>To return all county boundaries in the DVRPC region as a geojson start with the county boundary feature service</p>
<p>https://arcgis.dvrpc.org/portal/rest/services/Boundaries/CountyBoundaries/FeatureServer/0</p>
<p>Since we only want to show DVRPC counties and the data includes county boundaries outside of the DVRPC region, we need to use the field <code>dvrpc_reg</code> and set it's value to 'Yes'</p>
<p>Add <code>/query?where=dvrpc_reg='Yes'</code> to the service url like so <code>https://arcgis.dvrpc.org/portal/rest/services/Boundaries/CountyBoundaries/FeatureServer/0/query?where=dvrpc_reg='Yes'</code></p>
<p>Next we need to specify which fields we want to include in the output.  Since we want all fields to show we'll add <code>outfields=*</code>  Adding more parameters to our API request URL requires <code>&amp;</code> symbol like this <code>https://arcgis.dvrpc.org/portal/rest/services/Boundaries/CountyBoundaries/FeatureServer/0/query?where=dvrpc_reg='Yes'&amp;outfields=*</code></p>
<p>Finally we'll add our projection we want the output to be in and the format.  Here we'll use <code>outsr=4326</code> for WGS84 - World Geodetic System 1984 and <code>f=geojson</code> for our output type.</p>
<p>https://arcgis.dvrpc.org/portal/rest/services/Boundaries/CountyBoundaries/FeatureServer/0/query?where=dvrpc_reg='Yes'&amp;outfields=*&amp;outsr=4326&amp;f=geojson</p>
<h3 id="esri-documentation">ESRI documentation</h3>
<p>For more details about the capabilities and spec of using ESRI rest api check out https://developers.arcgis.com/rest/services-reference/enterprise/get-started-with-the-services-directory.htm</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.sections", "navigation.top", "toc.integrate"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>